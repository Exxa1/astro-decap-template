---
import { nav_items, call_to_action } from "@/data/nav_items"
import Socials_list from "@/components/Utilities/socials_list.astro"
import Logo from "@/components/Utilities/Logo.svg"
import DefaultPadding from "@/layouts/DefaultPadding.astro"
---

<header class="bg-colorfor-bg-header font-nav text-lg tracking-(--heading-font-spacing)">
	<DefaultPadding>
		<div class="mx-auto">
			<div class="flex h-32 items-center justify-between">
				<a
					class="absolute top-12 left-1/2 z-40 block h-32 -translate-x-1/2 transform"
					href={nav_items[0].link}
				>
					<span class="sr-only">{nav_items[0].name}</span>
					<div class="flex flex-row items-center">
						<div class="text-right text-base">Kunart</div>
						<div class="aspect-square h-24 w-24 p-1">
							<Logo class="h-full w-full" />
						</div>

						<div class="text-base">Portr√©k</div>
					</div>
				</a>

				<div class="absolute top-4 right-8 flex flex-row">
					<div class="p-2 pt-4 text-center">
						<a href={call_to_action.link} class="button darkbutton">{call_to_action.name}</a>
					</div>

					<button
						id="mobile-menu-button"
						class="group w-12 rounded-(--roundedness-button) p-2 transition"
						aria-controls="mobile-menu"
						aria-expanded="false"
						aria-label="Toggle menu"
					>
						<div
							class="bg-colorfor-hamburgermenu-lines my-2 h-1 w-10 transition-[width] duration-500 group-aria-expanded:w-12"
						>
						</div>
						<div
							class="bg-colorfor-hamburgermenu-lines my-2 h-1 w-12 transition-[width] duration-500 group-aria-expanded:w-8"
						>
						</div>
						<div
							class="bg-colorfor-hamburgermenu-lines my-2 h-1 w-8 transition-[width] duration-500 group-aria-expanded:w-10"
						>
						</div>
					</button>
				</div>
			</div>
		</div>
	</DefaultPadding>
</header>

<!-- Mobile menu-->
<nav
	id="mobile-menu"
	class="font-heading relative z-30 hidden text-2xl transition"
	aria-label="Global"
>
	<ul
		id="mobile_navlist"
		class="bg-colorfor-bg-page absolute flex h-screen w-full translate-x-full flex-col justify-evenly pb-32 transition-transform duration-300 ease-in-out"
	>
		{
			nav_items.map((item) => (
				<li class="text-center">
					<a class="hover:text-current/70" href={item.link}>
						{" "}
						{item.name}{" "}
					</a>
				</li>
			))
		}
		<li>
			<div class="p-2 text-center">
				<a href={call_to_action.link} class="button darkbutton">{call_to_action.name}</a>
			</div>
		</li>
		<li class="text-center">
			<Socials_list />
		</li>
	</ul>
</nav>

<script type="module">
	document.addEventListener("DOMContentLoaded", () => {
		// 1. Select the necessary elements
		const menuButton = document.getElementById("mobile-menu-button")
		const mobileMenu = document.getElementById("mobile-menu")
		const mobileNavList = document.getElementById("mobile_navlist")

		// Simple function to toggle the menu state
		const toggleMenu = () => {
			// Determine the current state based on the aria-expanded attribute
			const isExpanded = menuButton.getAttribute("aria-expanded") === "true"

			// 2. Toggle the button's aria-expanded state
			menuButton.setAttribute("aria-expanded", String(!isExpanded))

			// 3. Toggle the display property of the main menu wrapper
			// We do this first to make sure the nav is visible before the slide animation starts
			// and hidden after it completes.
			if (!isExpanded) {
				// SHOW MENU
				mobileMenu.classList.remove("hidden")
				// Allow the browser a moment to apply 'display: block' before triggering the transition
				// using the timeout ensures the CSS transition fires correctly.
				setTimeout(() => {
					mobileNavList.classList.remove("translate-x-full")
				}, 10) // A small delay is usually enough
			} else {
				// HIDE MENU - Start the slide-out transition
				mobileNavList.classList.add("translate-x-full")

				// Wait for the CSS transition to finish (duration is 300ms) before hiding the element
				mobileNavList.addEventListener(
					"transitionend",
					function handler() {
						mobileMenu.classList.add("hidden")
						// Crucially, remove the event listener after it runs once
						mobileNavList.removeEventListener("transitionend", handler)
					},
					{ once: true }
				)
			}
		}

		// 4. Attach the event listener to the button
		if (menuButton) {
			menuButton.addEventListener("click", toggleMenu)
		}

		// OPTIONAL: Close menu when a link inside the nav is clicked
		// This provides a better user experience on mobile devices.
		const navLinks = mobileNavList.querySelectorAll("a")
		navLinks.forEach((link) => {
			link.addEventListener("click", () => {
				// Check if the menu is open before trying to close it
				if (menuButton.getAttribute("aria-expanded") === "true") {
					toggleMenu()
				}
			})
		})
	})
</script>
