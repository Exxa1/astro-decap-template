---
import { nav_items, call_to_action } from "@/data/nav_items"
import Socials_list from "@/components/socials_list.astro"
import Logo from "@/components/Utilities/Logo.astro"

import DefaultPadding from "@/layouts/DefaultPadding.astro"
---

<header class="bg-colorfor-bg-header">
	<DefaultPadding>
		<div class="mx-auto">
			<div class="flex h-24 items-center justify-between">
				<div>
					<a class="text-colorfor-text-nav block relative top-2" href={nav_items[0].link}>
						<span class="sr-only">{nav_items[0].name}</span>
							<div class="h-20 w-20">
							<Logo />
							</div>
					</a>
				</div>

				<div class="md:flex md:items-center md:gap-12">
					<nav aria-label="Global" class="hidden md:block">
						<ul class="flex items-center gap-6">
							{
								nav_items.map((item) => (
									<li>
										<a
											class="text-colorfor-text-body hover:text-colorfor-text-body/70 transition"
											href={item.link}
										>
											{" "}
											{item.name}{" "}
										</a>
									</li>
								))
							}
						</ul>
					</nav>

					<div class="flex items-center gap-4">
						<div class="sm:flex sm:gap-4">
							<a
								class="bg-colorfor-bg-button text-colorfor-text-button hover:text-colorfor-text-button/70 rounded-md px-5 py-2.5 text-sm font-medium shadow-sm"
								href={call_to_action.link}
							>
								{call_to_action.name}
							</a>
						</div>

						<div class="block md:hidden">
							<button
								id="mobile-menu-button"
								class="bg-colorfor-bg-button-gray text-colorfor-text-body hover:text-colorfor-text-body/75 rounded-sm p-2 transition"
								aria-controls="mobile-menu"
								aria-expanded="false"
								aria-label="Toggle menu"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="size-5"
									fill="none"
									viewBox="0 0 24 24"
									stroke="currentColor"
									stroke-width="2"
								>
									<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"
									></path>
								</svg>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</DefaultPadding>

	<!-- Mobile menu (hidden on md and up) -->
	<nav id="mobile-menu" class="relative hidden transition md:hidden" aria-label="Global">
		<ul
			id="mobile_navlist"
			class="bg-colorfor-bg-page absolute flex h-screen w-full translate-x-full flex-col justify-evenly pb-32 transition-transform duration-300 ease-in-out"
		>
			{
				nav_items.map((item) => (
					<li class="text-center">
						<a
							class="text-colorfor-text-nav hover:text-colorfor-text-nav/70 text-lg"
							href={item.link}
						>
							{" "}
							{item.name}{" "}
						</a>
					</li>
				))
			}
			<li class="text-center">
				<Socials_list />
			</li>
		</ul>
	</nav>

	<script type="module">
		const btn = document.getElementById("mobile-menu-button")
		const menu = document.getElementById("mobile-menu")
		const mobile_nav = document.getElementById("mobile_navlist")

		// Ensure aria-hidden reflects initial state
		if (menu) menu.setAttribute("aria-hidden", menu.classList.contains("hidden") ? "true" : "false")

		const openMenu = () => {
			// reveal container first so the inner element is renderable for transition
			menu.classList.remove("hidden")
			menu.setAttribute("aria-hidden", "false")
			btn?.setAttribute("aria-expanded", "true")

			// remove the translate on next frame so transition runs
			requestAnimationFrame(() => {
				mobile_nav.classList.remove("translate-x-full")
			})
		}

		const closeMenu = () => {
			// slide out
			mobile_nav.classList.add("translate-x-full")
			btn?.setAttribute("aria-expanded", "false")
			menu.setAttribute("aria-hidden", "true")

			// after the transition finishes, hide the container to remove it from the flow
			const onTransitionEnd = (e) => {
				if (e.target === mobile_nav) {
					menu.classList.add("hidden")
					mobile_nav.removeEventListener("transitionend", onTransitionEnd)
				}
			}
			mobile_nav.addEventListener("transitionend", onTransitionEnd)
		}

		btn?.addEventListener("click", () => {
			const expanded = btn.getAttribute("aria-expanded") === "true"
			if (expanded) closeMenu()
			else openMenu()
		})

		// Close the mobile menu when the viewport becomes >= md
		const mq = window.matchMedia("(min-width: 768px)")
		const handleMq = (e) => {
			if (e.matches) {
				// if open, gracefully close
				if (btn?.getAttribute("aria-expanded") === "true") closeMenu()
				else {
					// ensure hidden state
					menu.classList.add("hidden")
					menu.setAttribute("aria-hidden", "true")
					btn?.setAttribute("aria-expanded", "false")
				}
			}
		}
		if (mq.addEventListener) mq.addEventListener("change", handleMq)
		else mq.addListener(handleMq)

		// Close on Escape
		document.addEventListener("keydown", (e) => {
			if (e.key === "Escape" && btn?.getAttribute("aria-expanded") === "true") {
				closeMenu()
				btn?.focus()
			}
		})
	</script>
</header>
