---
import BaseLayout from "@/layouts/BaseLayout.astro"

import { Image } from "astro:assets"
// You can remove this line since you are now dynamically importing all images:
// import myImage from './_R3_03028.jpg';

// 1. Get the map of import functions (using your alias)
const imageGlob = import.meta.glob("@/pages/portfolio/*.{jpg,jpeg,png,webp}")

// 2. Resolve all the imports concurrently using Promise.all()
//    The component's frontmatter must be implicitly 'async' to use 'await'.
const importedModules = await Promise.all(
	// Map over the functions (the values) and call each one
	Object.values(imageGlob).map((importFn) => importFn())
)

// 3. Extract the image asset data (the .default export) for each resolved module
const images = importedModules.map((mod) => mod.default).filter((image) => image) // Ensure we only have valid image objects
---

<BaseLayout>
	<div class="p-12">
		<div class="image-gallery flex flex-row flex-wrap gap-2 justify-around">
			{
				images.map((imageModule) => (
					// The 'imageModule' variable now holds the resolved image data
					// that <Image /> expects, which is the key fix!
					<Image src={imageModule} alt="A photo from the gallery" height={400} loading="lazy" />
				))
			}
		</div>
		<div class="m-10 text-center">
			<a href="/contact" class="button darkbutton w-fit">Foglalj Id≈ëpontot</a>
		</div>
	</div>
</BaseLayout>
